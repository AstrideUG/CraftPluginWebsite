!function(){"use strict";const e={displayModes:{DESKTOP:0,MOBILE:1}},t={websocket:!1,client:{interval:5e3,targetUrl:"https://heatmap.services",clientVersion:2,error:{timeout:1e4,maxOccurrence:3},trackers:{eventsList:["onclick","onmousemove","onscroll"],mouseMoveTimeout:80},windowProperties:{normalMobileWidth:400}}},i=window._debugMode,o=400,n=768,s=620,a=960;function r(e){const t=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o+=1)t.push(i.charAt(Math.floor(Math.random()*i.length)));return t.join("")}function d(e,t){let i;return(...o)=>{clearTimeout(i),i=setTimeout(()=>e(...o),t)}}function l(e){const{innerWidth:t,__page_generator:o,__config:a,__mobile_version:r}=e;if(o){const e=a&&a.mobileDisabled;return i&&console.log("isMobileMode PG:",!e&&t<n,t,n),!e&&t<n}return i&&console.log("isMobileMode",r&&t<n,t,n),r&&t<s}class h{constructor(e){this.ajaxPath="/api/raw-data",this.websocketPath="/ws/raw-data",this.options=e,this.useBeacon=!1}getFullRESTPath(){return this.options.targetUrl+this.ajaxPath}sendByAjax(e){return fetch(this.getFullRESTPath(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))}sendByBeacon(e){if(navigator&&navigator.sendBeacon){const t=this.getFullRESTPath();try{return navigator.sendBeacon(t,JSON.stringify(e)),Promise.resolve()}catch(t){return this.sendByAjax(e)}}return this.sendByAjax(e)}send(e){return this.useBeacon?this.sendByBeacon(e):this.sendByAjax(e)}}class c{constructor(e){this.pixelRatio=1,this.isMobileModeOn=l(e.window),this.options=e,this.isPopupOpened=!1,this.popupId=!1,this.errorCount=0,this.sendTimestamp=0,this.enableSend=!0,this.request=new h(e),this.sentScroll=0,this.currentMaxScrollDepth=0,this.storage=[],this.singleSessionStorage={},this.resetStorage()}resetStorage(){this.singleSessionStorage.mousemove=[],this.singleSessionStorage.click=[]}wrapDataToSend(e){return{displayMode:this.displayMode,sessionId:this.options.sessionId,pageId:this.options.pageId,version:this.options.pageVersion,variation:this.options.pageVariation,variationHash:this.options.pageVariationHash,popupId:this.popupId,clientVersion:this.options.clientVersion,data:e}}checkForDisplayModeChange(){this.displayMode?(this.isMobileModeOn||this.addDataToStorage(),this.isMobileModeOn=!0):(this.isMobileModeOn&&this.addDataToStorage(),this.leftEdgeElement||this.findEdgeElements(),this.isMobileModeOn=!1)}isPointInBoundaries({x:e,y:t}){const{leftMargin:i,topMargin:o,width:n,height:s}=this;return i<e&&i+n>e&&o<t&&o+s>t}findEdgeElements(){const{isPageGenerator:e,window:{document:{body:t,body:{clientWidth:i}}}}=this.options;let o,[n,s]=[i,0];o=e?t.getElementsByTagName("main").item(0).getElementsByClassName("widget"):t.getElementsByClassName("block-inner");for(let e=0;e<o.length;e++){const t=o.item(e),{left:i,right:a,width:r}=t.getBoundingClientRect();r&&n>i&&(n=i,this.leftEdgeElement=t),r&&s<a&&(s=a,this.rightEdgeElement=t)}o.length||(this.leftEdgeElement=this.innerSection,this.rightEdgeElement=this.innerSection),this.leftEdgeElement||(this.enableSend=!1)}findInnerSection(){const{isPageGenerator:e,window:{document:{body:t}}}=this.options,i=e?"section-inner":"block-inner",o=[...t.getElementsByClassName(i)];this.innerSection=o.find(e=>e.clientWidth),this.innerSection||(this.enableSend=!1)}updateHeatmapDivBoundaries(){const{isPageGenerator:t,heatmapDiv:n,window:{innerWidth:s,scrollX:r,scrollY:d,document:{body:{offsetHeight:h}}}}=this.options;let c,p,g,u,m,w=0;if(this.displayMode=function(t){return e.displayModes[l(t)?"MOBILE":"DESKTOP"]}(window),this.checkForDisplayModeChange(),this.isMobileModeOn){const{width:e,left:t}=this.innerSection.getBoundingClientRect();u=e,c=t,g=h}else c=this.leftEdgeElement.getBoundingClientRect().left,g=h,u=(p=this.rightEdgeElement.getBoundingClientRect().right)-c;if(this.isPopupOpened){const{left:e,right:t,height:i,width:o,top:n}=this.popupElement.getBoundingClientRect();c=e,w=n+d,p=t,g=i,u=o}if(c+=r,t)if(m=c,this.isMobileModeOn)this.pixelRatio=s<o?o/s:1;else{const{width:e}=this.innerSection.getBoundingClientRect();this.pixelRatio=a/e}else m=c>0?c:0;i&&console.log("Pixel ratio:",this.pixelRatio),this.leftMargin=m,this.topMargin=w,this.width=u,this.height=g,n.style.left=`${m}px`,n.style.width=`${u}px`,n.style.height=`${g}px`,n.style.top=`${w}px`}addPointToStorage(e,t,o){const{leftMargin:n,topMargin:s,pixelRatio:a,height:r,width:d}=this,l=t-n,h=o-s;l<0||h<0||l>d||h>r||(i&&"click"===e&&(console.log("addPointToStorage:",l,h,n,s,d,r),console.log("with pixelRatio:",Math.round(l*a),Math.round(h*a))),this.singleSessionStorage[e].push({x:Math.round(l*a),y:Math.round(h*a)}))}addDataToStorage(){const e=[];if(this.singleSessionStorage.mousemove.length&&e.push({eventName:"mousemove",data:this.singleSessionStorage.mousemove}),this.singleSessionStorage.click.length&&e.push({eventName:"click",data:this.singleSessionStorage.click}),this.currentMaxScrollDepth&&this.sentScroll<this.currentMaxScrollDepth&&(e.push({eventName:"scroll",data:[{y:this.currentMaxScrollDepth}]}),this.sentScroll=this.currentMaxScrollDepth),this.resetStorage(),e.length){const t=this.wrapDataToSend(e);this.storage.push(t)}}sendBeacon(){if(this.addDataToStorage(),this.storage.length){const e=this.storage.shift();this.request.send(e)}}sendData(){if(this.enableSend&&this.storage.length&&Date.now()>this.sendTimestamp){const e=this.storage.shift();this.request.send(e).then(()=>{this.errorCount=0}).catch(t=>{console.error(t);const{options:{error:i}}=this;this.errorCount+=1,this.errorCount<i.maxOccurrence?this.sendTimestamp=Date.now()+i.timeout:this.enableSend=!1,this.storage.push(e)})}}init(){this.findInnerSection(),this.isMobileModeOn||this.findEdgeElements(),this.updateHeatmapDivBoundaries(),this.resetStorage(),setInterval(()=>{this.addDataToStorage(),setTimeout(()=>{this.sendData()},this.options.interval/2)},this.options.interval)}}window.onload=(()=>{if(!window.__preview){const{__variant:o,__variant_hash:n,__version:s,__page_id:a,__page_generator:h,__workspaceWidth:p=960,__page_domain:g,location:{href:u}}=window;(!g||g&&-1===u.indexOf(g.replace("//","")))&&console.log("HEATMAP EVENTS COLLECTING BLOCKED");const{websocket:m,client:{targetUrl:w,interval:S,error:v,windowProperties:y,clientVersion:M,trackers:E}}=t;if(function(e,t){return!!t&&t.includes(e)}(`${n}:${e.displayModes[l(window)?"DESKTOP":"MOBILE"]}`,window.__predator_blacklist))return;const f=document.createElement("div");i&&document.body.appendChild(f);const b={window:window,heatmapDiv:f,pageVariationHash:n,interval:S,error:v,pageId:a,pageVersion:s,targetUrl:w,windowProperties:y,workspaceWidth:p,trackers:E,isPageGenerator:h,clientVersion:h?3:M,pageVariation:o.split("-")[0],sessionId:r(12),websocket:"true"===m||!0===m},x=new c(b),B=/iPhone|iPad/i.test(window.navigator.userAgent);let D=!1;const T=()=>{D||(x.request.useBeacon=!0,x.sendBeacon()),D=!0};i&&(f.setAttribute("id","heatmapDiv"),f.style.position="absolute",f.style.top="0px",f.style.left="0px",f.style.opacity=0,f.style.background="green",f.style.zIndex=1);const P=function(e,t){let i=0;return function(...o){const n=(new Date).getTime();if(!(n-i<e))return i=n,t(...o)}}(E.mouseMoveTimeout,x.addPointToStorage.bind(x)),_=({type:e,pageX:t,pageY:i})=>{x.isMobileModeOn&&B||!x.isPointInBoundaries({x:t,y:i})||P(e,t,i)},O=({type:e,pageX:t,pageY:o})=>{x.isPointInBoundaries({x:t,y:o})&&(i&&(console.log("mouse click event",t,o),console.log("SIZE:","heatmapDiv.width:",f.style.width,"window.outerWidth",window.outerWidth,"heatmapDiv.style.height",f.style.height,"window.outerHeight",window.outerHeight)),x.addPointToStorage(e,t,o))},k=()=>{x.isPopupOpened&&x.updateHeatmapDivBoundaries()};let I;const C=e=>{const{id:t,popup:o}=e.detail;x.addDataToStorage();const n=h?o.getElementsByClassName("lightbox-content")[0]:o.getElementsByClassName("popup-inner")[0];x.popupId=t,x.isPopupOpened=!0,x.popupElement=n,i&&(f.style.zIndex=10500001),setTimeout(()=>{(I=n.parentElement).addEventListener("scroll",k),x.updateHeatmapDivBoundaries()},500)},L=()=>{I.removeEventListener("scroll",k),x.addDataToStorage(),i&&(f.style.zIndex=1),x.popupId=!1,x.isPopupOpened=!1,setTimeout(()=>{x.updateHeatmapDivBoundaries()},h?1:200)},R=()=>{const e=Math.round((function(e){return e.scrollY||e.document.scrollTop||e.document.body.scrollTop||0}(window)+window.innerHeight)*x.pixelRatio),t=Math.floor(x.height*x.pixelRatio);return e>t?t:e},H=()=>{const e=R();x.currentMaxScrollDepth<e&&(x.currentMaxScrollDepth=e)},N=d(x.updateHeatmapDivBoundaries.bind(x),350),V=d(H.bind(void 0),100);x.init(document.body.firstElementChild),x.currentMaxScrollDepth=R(),window.addEventListener("preview.popup.shown",e=>setTimeout(()=>C(e))),window.addEventListener("preview.popup.hide",e=>setTimeout(()=>L(e))),window.addEventListener("resize",N),window.addEventListener("scroll",V),window.document.addEventListener("mousemove",_,!0),window.document.addEventListener("click",O,!0),i&&window.addEventListener("keyup",e=>{"h"===e.key?f.style.opacity=0:"s"===e.key&&(f.style.opacity=.3)}),window.addEventListener("beforeunload",T.bind(void 0)),window.addEventListener("unload",T.bind(void 0))}})}();
